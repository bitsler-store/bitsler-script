<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Download Your File</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="box">
  <h2>ğŸ“¥ Download</h2>
  <p id="msg">Verifying your order...</p>
  <button id="downloadBtn" style="display:none;">Download File</button>
</div>

<script>
const WORKER_URL = "https://crypto-backend.bijamalala.workers.dev";
const params = new URLSearchParams(window.location.search);
const orderId = params.get("orderId");

const msg = document.getElementById("msg");
const btn = document.getElementById("downloadBtn");

async function verifyOrder() {
  try {
    const res = await fetch(`${WORKER_URL}/public/order?orderId=${orderId}`);
    if (!res.ok) throw "Order not found";

    const order = await res.json();

    if (order.status !== "paid") {
      msg.innerText = "âŒ Payment not confirmed.";
      return;
    }

    msg.innerText = "âœ… Order verified. You can download your file.";
    btn.style.display = "inline-block";

    btn.onclick = () => {
      // ğŸ”’ tÃ©lÃ©chargement UNIQUEMENT via le worker
      window.location.href = `${WORKER_URL}/download-file?orderId=${orderId}`;
    };

  } catch (e) {
    msg.innerText = "âŒ Order invalid or expired.";
  }
}

verifyOrder();
</script>

</body>
</html>
